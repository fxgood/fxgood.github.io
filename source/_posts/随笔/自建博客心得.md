---
title: 自建博客过程记录
category: 随笔
excerpt: 记录一下自建博客的过程与坑点。
date: 2020-01-10
---

本博客采用hexo+gitee page+阿里云图床(阿里云对象存储oss)来建立的，主题选用的是基于hexo的icarus主题。一开始用的是hexo+githubpage，存在两个问题：1.博客部署在github部署和访问不稳定2.图片的使用和访问不方便。

# 建站过程

1. 下载node.js、git等工具。进入在windows命令行

2. 配置npm的国内源

   ```
   npm config set registry https://registry.npm.taobao.org		#配置国内的镜像源
   npm info hexo	# 测试查看hexo的安装信息，是否是taobao.org的源
   ```

3. 安装hexo

   ```
   npm install -g hexo 		# 通过npm安装hexo
   # -g 指定全局安装，可以使用hexo命令
   ```

4. 在自选的路径下，进行以下操作

   ```
   hexo init test		# 初始化创建，会再桌面创建test文件夹
   cd test				# 进入test目录
   npm install			# 进一步安装hexo所需文件
   ```

5. hexo安装完成，启动hexo

   ```
   hexo clean			# 清除所有记录
   hexo generate		# 生成静态网页
   hexo server -p 80	# 在80端口启动服务，如果写-p xx 则在默认端口
   ```

6. 浏览器访问`localhost:端口号`，可以查看博客当前的样子

7. 主题配置：将下载的hexo主题（可以去github或者百度知乎上搜喜欢的）放在themes文件夹下，然后修改`_config.yml`配置文件

   ```
   theme: xxx   # 这里与theme下主题文件夹的名称相同
   ```

8. 在gitee中创建和用户名相同的仓库，然后修改`_config.yml`中的仓库url

   ```
   deploy:
     type: git
     repo: https://gitee.com/fxgood/fxgood # gitee的仓库地址
   ```

9. cd到博客根目录下，输入命令`hexo generate && hexo deploy `或者`hexo g &&hexo d `，即可将博客部署到gitee page 

10. 阿里云购买域名，进行域名绑定

# Typora绑定阿里云图床

过程参考 https://zhuanlan.zhihu.com/p/138878534

# 注意事项

1. 通过gitee page来建博客，仓库名一定要与gitee用户名一致，这样可以采用`https://用户名.gitee.io/`的方式来访问博客。

2. 每次更新博客内容需要手动在gitee page上进行刷新（氪金会员据说可以自动刷新）

3. hexo配置和主题配置，分别在`_config.yml`和`_config.xxx主题名xx.yml`中

4. 写文章，就在`source/_posts/`下，可以再创建文件夹进行分类存放

5. 生成文章摘要有两种方法
   1. 在文章中某一行添加`<-- more -->`，则该行以上的内容会作为摘要
   2. 在md文件开头添加属性`excerpt:xxx`内容填写摘要即可
   
6. 添加代码实现文章首页顺序控制,修改`node_modules/hexo-generator-index/lib/generator.js`文件（没有top属性则比较日期，有则比较top大小，top越大文章在首页越靠前）

   ```javascript
   'use strict';
   
   const pagination = require('hexo-pagination');
   const { sort } = require('timsort');
   
   module.exports = function(locals) {
     const config = this.config;
     const posts = locals.posts.sort(config.index_generator.order_by);
     
     //添加这一段
     posts.data = posts.data.sort(function(a, b) {
       if(a.top && b.top) { // 两篇文章top都有定义
           if(a.top == b.top) return b.date - a.date; // 若top值一样则按照文章日期降序排
           else return b.top - a.top; // 否则按照top值降序排
       }
       else if(a.top && !b.top) { // 以下是只有一篇文章top有定义，那么将有top的排在前面
           return -1;
       }
       else if(!a.top && b.top) {
           return 1;
       }
       else return b.date - a.date; // 都没定义按照文章日期降序排
     });
     //到此截止
       
     sort(posts.data, (a, b) => (b.sticky || 0) - (a.sticky || 0));
   
     const paginationDir = config.pagination_dir || 'page';
     const path = config.index_generator.path || '';
   
     return pagination(path, posts, {
       perPage: config.index_generator.per_page,
       layout: ['index', 'archive'],
       format: paginationDir + '/%d/',
       data: {
         __index: true
       }
     });
   };
   
   
   ```

7. 我在github和gitee都部署了我的博客，其中githubpage绑定了我阿里云买的域名`fengxu.work`。用git更新博客的时候，只需要修改`_config.yml`中的deploy下的repo地址。（因为github和gitee用户名和邮箱相同）

# hexo常用命令

> 注：首先要用cmd或者git来到本地博客根目录

1. hexo init初始化博客
2. hexo clean 刷新部署
3. hexo generate 更新博客内容后，需要重新生成
4. hexo deploy 部署到远程服务器上
5. hexo c &&hexo g &&hexo d 可以一键完成上述三个功能
6. 遇到`OpenSSL SSL_read: Connection was aborted, , errno 10053`错误，原因是Git默认限制推送的大小，运行命令更改限制大小即可
   - `git config --global http.postBuffer 10000000000`

# 文章常用yaml front matter

1. `title: xxx`标题

2. `category: `分类

3. `tag: `标签

   ```
   # 多个标签下
   tag:
   - 二叉树
   - 递归
   ```

   

4. `excerpt: `文章摘要

5. `updated: 2020-04-01 00:00:00` 更新时间，（注意在`_config.icarus.yml`中article中可以设置update_time以实现控制)

6. `date: 2020-1-1 00:00:00` 创建时间 

7. `top: num` 根据num的大小，决定在首页的排列顺序，num越大优先级越高

# 常见问题解决方式

1. 更新推不上去

   - vpn挂美国节点

2. Git报错`connection was aborted,errno 10053`

   - git安装目录下`etc/gitconfig`设置postbuffer=100m，报错的原因是postbuffer缓存不足

     <img src="https://yfx-blog-image.oss-cn-hangzhou.aliyuncs.com/img/image-20211110204913817.png" alt="image-20211110204913817" style="zoom:80%;" align=left />

