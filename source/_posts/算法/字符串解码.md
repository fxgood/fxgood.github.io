---
title: 字符串解码
category: 算法
excerpt: 从这一题中再次领悟递归的奥秘. 同时对于栈如何解决括号相关问题有了更深入的理解.
---

[leetcode394 字符串解码](https://leetcode.cn/problems/decode-string/)

**特别注意**:做题的时候一定要看数据范围,这一题虽然用例数字都是1位的,但实际上可以是多位!

## 方法一: 递归

用递归解决问题就要把多层/多个问题,分解为一个子问题+其他所有. 我们的目标就是通过解决这一个子问题来递归解决整个问题.

对于本题来说,由于存在多个嵌套括号,那么我们应当将问题分解为解决一层括号+解决剩下内层所括号.可以采用后序的方法,先调用递归函数解决内层所有,然后再解决最外面一层.

```java
class Solution {
    //审题!
    boolean isNum(char c){
        return c<='9' && c>='0';
    }

    public String decodeString(String s) {
        //找第一个数字
        int index=-1;
        for(int i=0;i<s.length();i++){
            if(s.charAt(i)<='9' && s.charAt(i)>='0')
            {
                index=i;
                break;
            }
        }    
        if(index==-1)
            return s;
        int r=index;
        while(s.charAt(r)!='[')r++;

        int leftBracketIndex=r;
        int leftBracetCount=1; //左括号
        int rightBracketIndex=leftBracketIndex;
        while(leftBracetCount>0){
            rightBracketIndex++;
            if(s.charAt(rightBracketIndex)=='[')
                leftBracetCount++;
            else if(s.charAt(rightBracketIndex)==']')
                leftBracetCount--;
        }
        String ans=s.substring(0,index);

        int num=Integer.parseInt(s.substring(index,r));
        for(int i=0;i<num;i++)
            ans+=decodeString(s.substring(leftBracketIndex+1,rightBracketIndex));
        ans+=decodeString(s.substring(rightBracketIndex+1));
        return ans;
    }
}
```



## 方法二: 栈

用栈来解决括号相关问题是一个经典的方法

关于本题,凡遇到右括号再进行总结!否则直接入栈.

```java
class Solution {
    //括号问题用栈绝对是一个好方法
    public String decodeString(String s) {
        Stack<Character>st=new Stack<>();
        for(char c:s.toCharArray()){
            if(c!=']')
                st.push(c);
            else{
                Stack<Character>tmp=new Stack<>();
                while(st.peek()!='[')   //获取有效字符串
                    tmp.push(st.pop());
                StringBuilder ss=new StringBuilder();
                while(!tmp.isEmpty())
                    ss.append(tmp.pop());
                String cur=ss.toString();
                st.pop();   //抛出左括号
                while(!st.isEmpty() && isNum(st.peek()))
                    tmp.push(st.pop());
                int n=0;
                while(!tmp.isEmpty()){
                    n*=10;
                    n+=tmp.pop()-'0';
                }
                while(n>0){
                    n--;
                    for(char cc:cur.toCharArray()){
                        st.push(cc);
                    }
                }

            }
        }
        StringBuilder ans=new StringBuilder();
        while(!st.isEmpty()){
            ans.append(st.pop());
        }
        return ans.reverse().toString();
    }
    boolean isNum(Character c){
        return c<='9' && c>='0';
    }
}

```

